<!-- Photo feed -->

{% assign readmore = 'false' %}
<div
  class="Photo__collection {% if post.category != 'reportage' -%}has-lightbox {% if post.filenames.size >= 4 %}has-grid{% endif %}{% endif -%}"
>
  {% if post.category == 'reportage' %}

    <a href="{{ post.url }}" title="{{ post.title }}">
      {% if post.cover -%}
      {% assign location = post.location -%}
      {% if post.cover_location -%}
      {% assign location = post.cover_location -%}
      {% endif -%}
        {% include photos/single.html photo=post filename=post.cover location=location caption=post.caption ratio=post.ratio -%}
      {% elsif post.filenames -%}
        {% if post.filenames.first.filename -%}
          {% assign filename = post.filenames.first.filename -%}
          {% assign caption = post.filenames.first.caption -%}
          {% assign ratio = post.filenames.first.ratio -%}
        {% else -%}
          {% assign filename = post.filenames.first -%}
          {% assign ratio = post.ratio -%}
          {% assign caption = nil -%}
        {% endif -%}

        {% include photos/single.html photo=post filename=filename caption=caption ratio=ratio -%}
      {% elsif post.filename %}
        {% include photos/single.html photo=post filename=post.filename ratio=post.ratio -%}
      {% endif %}
    </a>
    {% assign readmore = 'true' %}
    
    {% if post.intro -%}
    <div class="Post__content">
      <p>{{ post.intro }}</p>
    </div>
    {% endif -%}

  {% elsif post.filenames -%}
    {% assign photo_count = post.filenames | size %}
    {% if photo_count >= 4 %}
      <div class="gg {% if post.square %}is-square{% endif %}">
        {% for file in post.filenames -%}
          {% if file.filename -%}
            {% assign filename = file.filename -%}
            {% assign caption = file.caption -%}
          {% else -%}
            {% assign filename = file -%}
            {% assign caption = '' -%}
          {% endif -%}
          <div class="Photo">
            {% include photos/single.html photo=post filename=filename caption=caption hide_caption=true -%}
          </div>
        {% endfor %}
      </div>
    {% else %}
      {% for file in post.filenames -%}
        {% if file.filename -%}
          {% assign filename = file.filename -%}
          {% assign caption = file.caption -%}
        {% else -%}
          {% assign filename = file -%}
          {% assign caption = '' -%}
        {% endif -%}
        {% include photos/single.html photo=post filename=filename caption=caption -%}
      {% endfor %}
    {% endif %}
    {% assign content = post.content | strip %}
    {% if content.size > 0 %}
      <div class="Post__content">{{ content }}</div>
    {% endif %}
  {% elsif post.filename %}
    {% include photos/single.html photo=post filename=post.filename -%}
    {% assign content = post.content | strip %}
    {% if content.size > 0 %}
      <div class="Post__content">{{ content }}</div>
    {% endif %}
  {% else %}
    {{ post.content }}
  {% endif %}
  {% include photos/footer.html photo=post pagination=false readmore=readmore -%}
</div>
